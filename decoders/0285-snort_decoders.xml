<!--
  -  Snort decoders
  -  Author: Daniel Cid.
  -  Updated by Wazuh, Inc.
  -  Copyright (C) 2015-2020, Wazuh Inc.
  -  Copyright (C) 2009 Trend Micro Inc.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->

<!--
  - Will extract the id, srcip and dstip
  - Examples:
  - snort: [1:469:3] ICMP PING NMAP [Classification: Attempted Information
    Leak] [Priority: 2]: {ICMP} 10.4.12.26 -> 10.4.10.231
  - snort: [1:1420:11] SNMP trap tcp [Classification: Attempted Information
    Leak] [Priority: 2]: {TCP} 10.4.12.26:37020 -> 10.4.10.231:162
  - [**] [1:1054:7] WEB-MISC weblogic/tomcat .jsp view source attempt [**]
    [Classification: Web Application Attack]
    [Priority: 1]  10.4.12.26:34041 -> 66.179.53.37:80
  - [**] [1:1421:11] SNMP AgentX/tcp request [**]
    [Classification: Attempted Information Leak] [Priority: 2]
    10.4.3.20:626 -> 10.4.10.161:705
  - [**] [1:1882:10] ATTACK-RESPONSES id check returned userid [**]
    [Classification: Potentially Bad Traffic] [Priority: 2]
    {UDP} 192.168.20.32 -> 192.168.20.2
  -->

<decoder name="snort">
  <program_name>^snort</program_name>
</decoder>

<decoder name="snort">
  <type>ids</type>
  <prematch>^[**] [\d+:\d+:\d+] </prematch>
</decoder>

<!-- This fixes an issue that arises from the snort2 decoder below of alerts that trigger with no ports and wont extract data correctly.
     Examples:
     - snort: [136:1:1] (spp_reputation) packets blacklisted [Classification: Potentially Bad Traffic] [Priority: 2] {ICMP} 10.1.1.1 -> 8.8.8.8
-->
<decoder name="snort3">
   <parent>snort</parent>
   <type>ids</type>
   <prematch>^[\d+:\d+:\d+] \(\S+\) </prematch>
   <regex>[(\d+:\d+:\d+)] (\.+) </regex>
   <regex>(\S+) -> (\S+)</regex>
   <order>id,data,srcip,dstip</order>
   <fts>name,id,srcip,dstip</fts>
</decoder>

<!-- This allows the decoder to grab rule description and srcport and dstport.
     Examples:
     - snort: [1:3668:14] SERVER-MYSQL client authentication bypass attempt [Classification: Misc Attack] [Priority: 2] {TCP} 10.0.0.1:33724 -> 10.0.5.1:3306
-->

<decoder name="snort2">
   <parent>snort</parent>
   <type>ids</type>
   <prematch>^[\d+:\d+:\d+] </prematch>
   <regex>[(\d+:\d+:\d+)] (\.+) </regex>
   <regex>(\S+):(\S+) -> (\S+):(\S+)</regex>
   <order>id,data,srcip,srcport,dstip,dstport</order>
   <fts>name,id,srcip,dstip</fts>
</decoder>

